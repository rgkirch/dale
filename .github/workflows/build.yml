name: build
on: push
jobs:
#  build-14:
#    runs-on: ubuntu-22.04
#    steps:
#      - uses: actions/checkout@v1
#      - run: sudo apt-get install build-essential llvm-14 llvm-14-dev clang-14 libedit-dev
#      - run: cmake -DLLVM_CONFIG=/usr/bin/llvm-config-14 . && make && make tests

#workaround to remove log output from "spinner"
#https://gist.github.com/asheroto/96bcabe428e8ad134ef204573810041f
#also see
#https://github.com/microsoft/winget-cli/issues/3494
  build-win-14:
    #https://github.com/actions/runner-images/blob/main/images/windows/Windows2019-Readme.md
    runs-on: windows-2019
    steps:
      #https://github.com/llvm/actions/blob/main/setup-windows/vs_setup.bat
      - uses: llvm/actions/setup-windows@main
        with:
          arch: amd64
      - uses: microsoft/setup-msbuild@v2
      - run: Invoke-WebRequest -Uri https://codeload.github.com/llvm/llvm-project/tar.gz/refs/tags/llvmorg-14.0.6 -OutFile llvm-project.tar.gz
      - run: ls
      - run: mkdir temp
      - run: tar -xf llvm-project.tar.gz -C temp
      - run: mkdir llvm-project
      - run: mv temp/*/* llvm-project
      - run: rm -r temp
      - run: ls llvm-project
      - working-directory: llvm-project
        run: cmake -S llvm -B build -G "Visual Studio 16 2019" -A x64 -DLLVM_ENABLE_PROJECTS='clang' -DCMAKE_BUILD_TYPE=Release
      - run: ls llvm-project
      - working-directory: llvm-project
        run: msbuild Dale.sln
      - uses: actions/checkout@v1
      - run: cmake .
#  build-macos-14:
#    runs-on: macos-latest
#    steps:
#      - uses: actions/checkout@v1
#      - run: brew install llvm@14
#      - run: PATH="/usr/local/opt/llvm@14/bin:$PATH" cmake . && make -j$(nproc) && make tests
